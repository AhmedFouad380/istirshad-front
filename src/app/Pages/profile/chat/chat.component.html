<div class="flex flex-col md:flex-row h-screen md:pt-15 pt-10 bg-white">

  <main class="flex-1 flex flex-col overflow-hidden">
    <!-- ุงูุชุงุฑูุฎ -->
      <!-- <div class="text-center text-xs text-gray-400 py-2">{{ selectedExpert?.date }}</div> -->
  
      <div #scrollContainer (scroll)="onScroll($event)" class="flex-1 px-12 py-8 overflow-y-scroll space-y-4 h-full" style="overflow-y: scroll;">
        <!-- Loading indicator for pagination -->
        <div *ngIf="isLoadingMore" class="text-center py-2">
          <span class="text-gray-500 text-sm">ุฌุงุฑู ุชุญููู ุงููุฒูุฏ...</span>
        </div>
        
        <div *ngFor="let msg of experts?.data?.message?.data; let i = index"
             [ngClass]="msg.alignment"
             class="flex flex-col space-y-1">
          <div *ngIf="msg.content"
               [ngClass]="msg.style"
               class="px-4 py-2 rounded-xl text-sm max-w-xs font-semibold relative">
            {{ msg.content }}
               <span *ngIf="msg.alignment === 'items-end'" class="absolute -right-5 bottom-1 flex items-center">
                <span *ngIf="msg.status === 'sending'" class="text-gray-400 text-xs">...</span>
                <span *ngIf="msg.status === 'success'" class="text-green-500 text-xs">โ</span>
                <span *ngIf="msg.status === 'error'" 
                      class="text-red-500 text-xs cursor-pointer hover:text-red-700"
                      (click)="resendMessage(msg)">โ</span>
                <span *ngIf="msg.status === 'success'" class="ml-1">
                  <ng-container *ngIf="msg.isRead; else notSeen">โโ</ng-container>
                  <ng-template #notSeen>โ</ng-template>
                </span>
              </span>
         
          </div>
    
          <!-- ุตูุช - Modern Voice Message Design -->
          <div *ngIf="msg.audioSrc" class="relative">
            <div [ngClass]="msg.alignment === 'items-start' ? 'bg-[#6E5EA9]' : 'bg-[#F4F4F4]'" 
                 class="rounded-xl p-3 max-w-xs shadow-sm">
              <div class="flex items-center gap-3">
           
                
                <!-- Audio player -->
                <audio
                  class="flex-1 h-8"
                  controls
                  [src]="msg.audioSrc"
                  style="filter: brightness(0.9);">
                  ุงููุชุตูุญ ูุง ูุฏุนู ุชุดุบูู ุงูุตูุช.
                </audio>
              </div>
            </div>
            
            <!-- Status indicators -->
            <span *ngIf="msg.alignment === 'items-end'" class="absolute -right-5 bottom-1 flex items-center">
              <span *ngIf="msg.status === 'sending'" class="text-gray-400 text-xs">...</span>
              <span *ngIf="msg.status === 'success'" class="text-green-500 text-xs">โ</span>
              <span *ngIf="msg.status === 'error'" 
                    class="text-red-500 text-xs cursor-pointer hover:text-red-700 transition-colors"
                    (click)="resendMessage(msg)"
                    title="ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู">โ</span>
            </span>
          </div>
          
          <!-- ุตูุฑุฉ -->
          <div *ngIf="msg.isImage" class="relative">
            <img [src]="msg.file" alt="ุตูุฑุฉ ูุฑููุฉ" class="w-52 rounded-xl" />
            
            <!-- ุญุงูุฉ ุงูุฅุฑุณุงู ููุตูุฑ -->
            <span *ngIf="msg.alignment === 'items-end'" class="absolute -right-5 bottom-1 flex items-center">
              <span *ngIf="msg.status === 'sending'" class="text-gray-400 text-xs">...</span>
              <span *ngIf="msg.status === 'success'" class="text-green-500 text-xs">โ</span>
              <span *ngIf="msg.status === 'error'" 
                    class="text-red-500 text-xs cursor-pointer hover:text-red-700"
                    (click)="resendMessage(msg)">โ</span>
            </span>
          </div>
          
          <div #bottom></div>
          
          <!-- ููู -->
          <div *ngIf="msg.isDocument" class="relative">
            <a [href]="msg.file" download target="_blank" class="text-blue-600 underline text-sm">
              ุชุญููู ุงูููู
            </a>
            
            <!-- ุญุงูุฉ ุงูุฅุฑุณุงู ูููููุงุช -->
            <span *ngIf="msg.alignment === 'items-end'" class="absolute -right-5 bottom-1 flex items-center">
              <span *ngIf="msg.status === 'sending'" class="text-gray-400 text-xs">...</span>
              <span *ngIf="msg.status === 'success'" class="text-green-500 text-xs">โ</span>
              <span *ngIf="msg.status === 'error'" 
                    class="text-red-500 text-xs cursor-pointer hover:text-red-700"
                    (click)="resendMessage(msg)">โ</span>
            </span>
          </div>
          
          <!-- ุงูููุช -->
          <div class="flex items-center justify-between text-xs text-gray-400 mt-1">
            <span *ngIf="i === experts.data.message.data.length - 1 || msg.time !== experts.data.message.data[i + 1]?.time">
              {{ msg.time }}
            </span>
          </div>
        </div>
      </div>
      <div *ngIf="selectedImage && imagePreview" class="relative inline-block">
        <img
          [src]="imagePreview"
          alt="ุตูุฑุฉ ูุฎุชุงุฑุฉ"
          class="w-24 h-24 object-contain rounded"
        />
      
        <button
          (click)="removeSelectedImage()"
          class="absolute -top-2 right-20 rounded-full w-5 h-5 text-xs text-red-500 flex items-center justify-center"
          title="ุฅุฒุงูุฉ ุงูุตูุฑุฉ"
        >
          โ
        </button>
      </div>
      
      
      
      <!-- ๐ ุนุฑุถ ุงุณู ุงูููู ุงููุฎุชุงุฑ -->
      <div *ngIf="selectedFile" class="mt-2 flex items-center gap-2">
        <span class="text-sm text-gray-700">{{ selectedFile.name }}</span>
        <button (click)="removeSelectedFile()" class="text-red-500 text-sm">ุฅุฒุงูุฉ</button>
      </div>
      <!-- ูุฑุจุน ุงููุชุงุจุฉ -->
      <div *ngIf="experts?.data?.consultation?.type!=='completed'" class="p-4 bg-white flex flex-wrap md:flex-nowrap items-end justify-between gap-3">
        <!-- ุฒุฑ ุงููุงูู ูุงูุฑุณุงูุฉ ุงูุตูุชูุฉ -->
          <!-- ุฃููููุงุช ุงูุจุญุซุ ูููุ ุตูุฑุฉ -->
      
          <div class="flex items-center gap-3 pr-2">
            <div class="flex flex-col items-center gap-1 text-[#6E5EA9] text-xs cursor-pointer" (click)="imageInput.click()">
              <span>ุตูุฑุฉ</span>

                <svg width="30" height="30" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3.8702 28.5149L3.8402 28.5449C3.4352 27.6599 3.1802 26.6549 3.0752 25.5449C3.1802 26.6399 3.4652 27.6299 3.8702 28.5149Z" fill="#6E5EA9"/>
                    <path d="M13.4997 15.5697C15.4713 15.5697 17.0697 13.9713 17.0697 11.9997C17.0697 10.028 15.4713 8.42969 13.4997 8.42969C11.528 8.42969 9.92969 10.028 9.92969 11.9997C9.92969 13.9713 11.528 15.5697 13.4997 15.5697Z" fill="#6E5EA9"/>
                    <path d="M24.285 3H11.715C6.255 3 3 6.255 3 11.715V24.285C3 25.92 3.285 27.345 3.84 28.545C5.13 31.395 7.89 33 11.715 33H24.285C29.745 33 33 29.745 33 24.285V20.85V11.715C33 6.255 29.745 3 24.285 3ZM30.555 18.75C29.385 17.745 27.495 17.745 26.325 18.75L20.085 24.105C18.915 25.11 17.025 25.11 15.855 24.105L15.345 23.685C14.28 22.755 12.585 22.665 11.385 23.475L5.775 27.24C5.445 26.4 5.25 25.425 5.25 24.285V11.715C5.25 7.485 7.485 5.25 11.715 5.25H24.285C28.515 5.25 30.75 7.485 30.75 11.715V18.915L30.555 18.75Z" fill="#6E5EA9"/>
                    </svg>
                    <input type="file" #imageInput hidden accept="image/*" (change)="handleImageUpload($event)" />

            </div>
        
            <div class="flex flex-col items-center gap-1 text-[#6E5EA9] text-xs cursor-pointer" (click)="fileInput.click()">
              <span>ููู</span>

                <svg width="28" height="28" viewBox="0 0 32 34" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M30.3158 13.923H25.4484C21.4568 13.923 18.2063 10.642 18.2063 6.613V1.7C18.2063 0.765 17.4484 0 16.5221 0H9.38105C4.19368 0 0 3.4 0 9.469V24.531C0 30.6 4.19368 34 9.38105 34H22.6189C27.8063 34 32 30.6 32 24.531V15.623C32 14.688 31.2421 13.923 30.3158 13.923Z" fill="#6E5EA9"/>
                    </svg>
                      <input type="file" #fileInput hidden (change)="handleFileUpload($event)" />

            </div>
     
         
          </div>
      
        <!-- input + ุฒุฑ ุงูุฅุฑุณุงู ุฏุงุฎู ุญุงููุฉ ุจูุถุงุก -->
        <div class="flex items-center flex-1 bg-[#F5F4F8] px-4 py-2 rounded-full gap-2 relative overflow-hidden">
          <!-- Recording Animation Background -->
          <div *ngIf="isRecording" 
               class="absolute inset-0 bg-gradient-to-r from-red-50 via-red-100 to-red-50 animate-pulse">
          </div>
          
          <input
          *ngIf="!isRecording"
            type="text"
            placeholder="Aa"
            [(ngModel)]="newMessage"
            (keydown.enter)="sendMessage()"
            class="flex-1 bg-transparent text-sm focus:outline-none placeholder-gray-400 relative z-10"
          />
          
          <!-- Modern Recording Display -->
          <div *ngIf="isRecording" class="flex items-center justify-between w-full relative z-10 px-2">
            <div class="flex items-center gap-3">
              <!-- Recording Pulse Animation -->
              <div class="relative flex items-center justify-center">
                <div class="w-3 h-3 bg-red-500 rounded-full animate-ping absolute"></div>
                <div class="w-3 h-3 bg-red-600 rounded-full"></div>
              </div>
              <span class="text-red-600 text-sm font-semibold">ุฌุงุฑู ุงูุชุณุฌูู</span>
            </div>
            
            <!-- Timer with modern style -->
            <div class="flex items-center gap-2">
              <span class="text-red-600 text-base font-mono font-bold">{{ recordingDuration }}</span>
              <div class="flex gap-1">
                <div class="w-1 h-6 bg-red-500 rounded-full animate-bounce" style="animation-delay: 0s"></div>
                <div class="w-1 h-5 bg-red-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                <div class="w-1 h-7 bg-red-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                <div class="w-1 h-4 bg-red-400 rounded-full animate-bounce" style="animation-delay: 0.3s"></div>
              </div>
            </div>
            
            <!-- Cancel Button -->
            <button 
              (click)="cancelRecording(); $event.stopPropagation()"
              class="text-red-600 hover:text-red-800 transition-colors">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>
          
          <!-- ุฒุฑ ุงูุฅุฑุณุงู (ุฃููููุฉ ุณูู) -->
          <button
            (click)="sendMessage()"
            [disabled]="isRecording && !audioBlob"
            class="w-8 h-8 rounded-full bg-white flex items-center justify-center shadow-sm hover:shadow-md transition-shadow relative z-10 disabled:opacity-50"
          >
          <svg width="20" height="20" viewBox="0 0 27 27" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7.58126 0.567152L20.4913 4.85762C29.1696 7.76083 29.1696 12.4946 20.4913 15.3836L16.6598 16.6564L15.3874 20.4892C12.4994 29.1703 7.75282 29.1703 4.86485 20.4892L0.561493 7.58921C-1.35429 1.79708 1.79102 -1.36356 7.58126 0.567152ZM7.12376 8.26139L12.5566 13.7246C12.771 13.9391 13.0427 14.0392 13.3143 14.0392C13.5859 14.0392 13.8576 13.9391 14.072 13.7246C14.4867 13.3098 14.4867 12.6234 14.072 12.2086L8.63923 6.74542C8.22462 6.33068 7.53837 6.33068 7.12376 6.74542C6.70915 7.16017 6.70915 7.84664 7.12376 8.26139Z" fill="#6E5EA9"/>
            </svg>
          </button>
        </div>
      
     
        <div class="flex items-center flex-col gap-1 relative group">
            <span class="text-xs text-[#6E5EA9] transition-all group-hover:text-[#5A4A8F]">ุฑุณุงูุฉ ุตูุชูุฉ</span>
            <div class="relative">
              <button 
              (click)="toggleRecording()" 
              [ngClass]="{
                'bg-red-500 scale-110 shadow-lg shadow-red-500/50': isRecording,
                'bg-[#F5F4F8] hover:bg-[#E5E4F0]': !isRecording
              }"
              class="w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 relative overflow-hidden">
                
                <!-- Microphone Icon (when not recording) -->
                <svg *ngIf="!isRecording" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 15C13.66 15 15 13.66 15 12V6C15 4.34 13.66 3 12 3C10.34 3 9 4.34 9 6V12C9 13.66 10.34 15 12 15Z" fill="#6E5EA9"/>
                  <path d="M17 11C17 14.31 14.31 17 11 17C7.69 17 5 14.31 5 11H3C3 14.41 5.72 17.23 9 17.72V21H11V17.72C14.28 17.23 17 14.41 17 11H17Z" fill="#6E5EA9"/>
                </svg>
                
                <!-- Stop Icon (when recording) -->
                <svg *ngIf="isRecording" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="6" y="6" width="12" height="12" rx="2" fill="white"/>
                </svg>
                
                <!-- Ripple effect when recording -->
                <div *ngIf="isRecording" class="absolute inset-0 rounded-full bg-red-400 animate-ping opacity-75"></div>
              </button>
              
              <img src="assets/images/Rectangle 7075.png" class="absolute w-[40%] right-5 bottom-2 pointer-events-none" alt="" />
            </div>
          </div>
      </div>
      <div *ngIf="experts?.data?.consultation?.type=='completed'"  class="p-4 bg-red-200 flex items-center justify-center gap-3">
          <p>ุชู ุงูุชูุงุก ุงููุญุงุฏุซู</p>
           
               
                </div>

      
    </main>
    <button class="fixed top-18 left-4 z-30 md:hidden bg-[#6E5EA9] text-white w-10 h-10 rounded-full flex items-center justify-center shadow"
    (click)="showMobileMenu = !showMobileMenu">
โฐ
</button>
<!-- ุงููุงุฆูุฉ ุงูููุจุซูุฉ ููููุจุงูู -->
<!-- Drawer ูุธูุฑ ูู ุงูุดูุงู -->
<div *ngIf="showMobileMenu" class="fixed inset-0 z-50 bg-black/50 flex md:hidden">
  <div class="bg-white w-64 h-full shadow-lg p-6 flex flex-col gap-5 relative animate-slide-in-right">
    <!-- ุฒุฑ ุฅุบูุงู -->
    <button (click)="showMobileMenu = false" class="absolute top-2 left-2 text-gray-500 text-xl font-bold">โ</button>

    <!-- ุตูุฑุฉ ุงูุฎุจูุฑ ู ุงูุงุณู -->
    <div class="flex flex-col items-center">
      <img [src]="experts?.data?.chat?.consultant.image" class="w-16 h-16 rounded-full mb-1" alt="expert" />
      <h2 class="font-bold text-sm text-[#231E31] text-center">
        {{ experts?.data?.chat?.consultant?.name }}
      </h2>
    </div>

    <!-- ุนูุงุตุฑ ุงููุงุฆูุฉ -->
    <div class="flex flex-col items-center text-sm text-[#231E31] gap-4 mt-6">
      <div
        [routerLink]="['/expert', experts?.data?.chat?.consultant?.id ]"
        *ngIf="userdata.type === 'user'"
        (click)="showMobileMenu = false"
        class="flex flex-col items-center cursor-pointer"
      >
        <img src="assets/images/Ellipse 333.png" class="w-8 h-8" />
        <span>ููู ุงูุฎุจูุฑ</span>
      </div>


      <div (click)="startCall()" class="flex flex-col items-center cursor-pointer">
        <img src="assets/images/Ellipse 334.png" class="w-8 h-8" />
        <span>ุทูุจ ููุงููุฉ</span>
      </div>


      <div class="flex flex-col items-center">
        <img src="assets/images/Ellipse 338.png" class="w-8 h-8" />
        <span>ุฅุจูุงุบ ุฃู ุดููู</span>
      </div>

      <button
        *ngIf="experts?.data?.consultation?.type !== 'completed' && userdata.type !== 'user'"
        (click)="endChat(); showMobileMenu = false"
        class="bg-[#991B1B] text-white text-sm px-4 py-2 rounded-full font-semibold mt-4"
      >
        ุฅููุงุก ุงููุญุงุฏุซุฉ
      </button>
    </div>
  </div>
</div>

    <!-- ูุนูููุงุช ุงูุฎุจูุฑ -->
    <aside
    class="w-full md:w-1/6 bg-[#FAFAFA] shadow  flex-col items-center md:py-6 pb-7 order-first md:order-none md:flex hidden"
  >      
          <!-- ุตูุฑุฉ ุงูุฎุจูุฑ ู ุงูุงุณู -->
          <img [src]="experts?.data?.chat?.consultant.image" class="w-16 h-16 rounded-full mb-2" alt="expert" />
          <h2 class="font-bold text-sm text-[#231E31]">{{ experts?.data?.chat?.consultant?.name }}</h2>
      
          <!-- ุนูุงุตุฑ ุงููุงุฆูุฉ -->
          <div class="flex md:flex-col flex-row items-center justify-center gap-6 mt-10 w-full md:w-auto">
            <!-- ููู ุงูุฎุจูุฑ -->
            <div 
              [routerLink]="['/expert', experts?.data?.chat?.consultant?.id ]"
              *ngIf="userdata.type === 'user'" 
              class="flex flex-col items-center text-xs text-[#231E31] gap-1"
            >
              <img src="assets/images/Ellipse 333.png" class="w-7 h-7" />
              <span class="hidden md:block">ููู ุงูุฎุจูุฑ</span>
            </div>
          
            <!-- ุทูุจ ููุงููุฉ -->
       <div (click)="startCall()" class="flex flex-col items-center text-xs text-[#231E31] cursor-pointer">
  <img src="assets/images/Ellipse 334.png" class="w-8 h-8" />
  <span>ุทูุจ ููุงููุฉ</span>
</div>
          
            <!-- ุฅุจูุงุบ ุฃู ุดููู -->
            <div  (click)="showComplaintModal = true" class="flex flex-col items-center text-xs text-[#231E31] gap-1">
              <img src="assets/images/Ellipse 338.png" class="w-7 h-7" />
              <span class="hidden md:block">ุฅุจูุงุบ ุฃู ุดููู</span>
            </div>
          </div>
  
      
          <!-- ุฒุฑ ุฅููุงุก ุงููุญุงุฏุซุฉ -->
    <!-- ูุฃุฌูุฒุฉ ุณุทุญ ุงูููุชุจ (ูุต + ุฒุฑ) -->
<button
*ngIf="experts?.data?.consultation?.type !== 'completed' && userdata.type !== 'user'"
class="mt-auto bg-[#991B1B] text-white text-sm px-5 py-2 rounded-full font-semibold mb-4 hidden md:block"
(click)="endChat()"
>
ุทูุจ ุฅููุงุก ุงููุญุงุฏุซุฉ
</button>

<!-- ูุฃุฌูุฒุฉ ุงูููุจุงูู (ุฃููููุฉ ููุท) -->
<button
*ngIf="experts?.data?.consultation?.type !== 'completed' && userdata.type !== 'user'"
class="mt-auto text-[#991B1B] text-xl mb-4 md:hidden"
(click)="endChat()"
title="ุทูุจ ุฅููุงุก ุงููุญุงุฏุซุฉ"
>
๐
</button>

          <div  *ngIf="showConfirmModal"  class="fixed inset-0 bg-black/50 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-md w-full">
              <h3 class="text-lg font-semibold text-gray-900">ูู ุฃูุช ูุชุฃูุฏ ูู ุฅููุงุก ุงููุญุงุฏุซุฉุ</h3>
              <p class="mt-2 text-sm text-gray-500">ูู ุชุชููู ูู ุงูุนูุฏุฉ ุฅูู ูุฐู ุงููุญุงุฏุซุฉ ุจุนุฏ ุฅููุงุฆูุง</p>
              
              <div class="mt-4 flex justify-end space-x-3">
                <button 
                  (click)="onCancel()"
                  class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200"
                >
                  ุฅูุบุงุก
                </button>
                <button 
                  (click)="onConfirm()"
                  class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700"
                >
                  ูุนูุ ุฅููุงุก ุงููุญุงุฏุซุฉ
                </button>
              </div>
            </div>
          </div>
          <!-- ูุงูุฐุฉ ุงูุชูููู -->
          <div *ngIf="showRateModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-3xl w-full text-center relative">
              <h2 class="text-2xl font-bold text-gray-800 mb-1">
                ุดูุฑุง ุนูู ุชุฌุฑุจู ูุน <span class="text-[#6E5EA9]">ุฃุณุชุฑุดุงุฏ!</span>
              </h2>
              <p class="text-sm text-gray-500 mb-6">
                ูุญุชุงุฌ ุฑุฃูู ูุชููููู ููู ูุณุงุนุฏูุง ุนูู ุชุทููุฑ ุงููููุน ุจุดูู ุฃุณุฑุน
              </p>
              <div class="absolute top-4 left-4 md:left-6">
              <button  (click)="showRateModal = false; completeConsultation()"
                class="w-8 h-8 rounded-full bg-[#6E5EA9] text-white flex items-center justify-center text-xl font-bold shadow hover:bg-[#5a4e98] transition">
                  ร
                </button>
              </div>

              <hr class="my-4 border-t border-[#000000]" />
          
              <h3 class="text-2xl  mb-4">ุชููููู</h3>
              <div class="grid grid-cols-2 md:grid-cols-5 gap-2 mb-4 text-sm font-medium text-gray-700 text-center">
                <div *ngFor="let option of ratingOptions" class="flex flex-col items-center gap-1">
              
                  <!-- ุงูุฒุฑ -->
                  <button (click)="rate = option.value"
                    [ngClass]="rate === option.value 
                      ? 'bg-[#6E5EA9] text-white border border-black font-bold' 
                      : 'bg-gray-100 text-gray-800'"
                    class="px-3 py-2 rounded-md w-full transition-all duration-150">
                    {{ option.label }}
                  </button>
              
                  <!-- ุนุฏุฏ ุงููุฌูู ุงูุซุงุจุช -->
                  <div class="text-base leading-tight">
                    <ng-container *ngFor="let star of [1,2,3,4,5]">
                      <span *ngIf="star <= option.value"
                        [ngClass]="rate === option.value ? 'text-yellow-500' : 'text-gray-300'">
                        โ
                      </span>
                    </ng-container>
                  </div>
              
                </div>
              </div>
              
              
              
          
              <textarea [(ngModel)]="description" rows="10"
                class="w-full p-3 border-0 bg-[#F2F2F2] rounded-md text-sm  focus:outline-none focus:ring-0 "
                placeholder="ุฑุฃูู ููููุง"></textarea>
          
              <div class="mt-6 flex justify-center">
                <button (click)="submitRate()"
                  class="bg-[#6E5EA9] hover:bg-[#5a4e98] text-white font-semibold px-8 py-2 rounded-md flex items-center gap-2 text-sm">
                  <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10.7882 0.315084L3.61592 2.69868C-1.20531 4.31157 -1.20531 6.94147 3.61592 8.54642L5.74457 9.25356L6.45147 11.3829C8.0559 16.2057 10.6929 16.2057 12.2973 11.3829L14.6881 4.21623C15.7524 0.99838 14.005 -0.757532 10.7882 0.315084ZM11.0424 4.58966L8.02413 7.62477C7.90498 7.74395 7.75407 7.79956 7.60316 7.79956C7.45225 7.79956 7.30134 7.74395 7.1822 7.62477C6.95186 7.39435 6.95186 7.01298 7.1822 6.78257L10.2004 3.74746C10.4308 3.51704 10.812 3.51704 11.0424 3.74746C11.2727 3.97787 11.2727 4.35925 11.0424 4.58966Z" fill="white"/>
                    </svg>
                    
                  ุฅุฑุณุงู
                </button>
              </div>
            </div>
          </div>
          
      </aside>
      
  </div>        <!-- ุดููู ูุฅุจูุงุบ Modal -->
  <div *ngIf="showComplaintModal" class="fixed inset-0 bg-black/50 flex items-center  justify-center z-50">
    <div class="bg-white rounded-lg p-6 max-w-3xl w-full text-center relative">
  
      <!-- ุฒุฑ ุงูุฅุบูุงู -->
      <div class="absolute top-4 left-4">
        <button (click)="showComplaintModal = false"
          class="w-7 h-7 rounded-full bg-[#6E5EA9] text-white flex items-center justify-center text-lg font-bold shadow hover:bg-[#5a4e98] transition">
          ร
        </button>
      </div>
  
      <!-- ุงูุนููุงู -->
      <h2 class="text-xl  text-[#231E31] mb-6 text-center">ุดููู ูุฅุจูุงุบ</h2>
  
      <!-- ุงููุงุฆูุฉ ุงูููุณุฏูุฉ -->
      <select
      [(ngModel)]="selectedReason"
      class="relative w-full appearance-none bg-[#F2F2F2] text-right mb-5 text-sm font-semibold py-3 px-4 rounded-md pr-10"
      style="background-image: url('data:image/svg+xml;utf8,<svg fill=\'%23000000\' height=\'24\' viewBox=\'0 0 24 24\' width=\'24\' xmlns=\'http://www.w3.org/2000/svg\'><path d=\'M7 10l5 5 5-5z\'/></svg>'); background-repeat: no-repeat; background-position: left 0.75rem center; background-size: 1rem;"
    >
        <option *ngFor="let reason of complaintReasons" [value]="reason">
          {{ reason }}
        </option>
      </select>
  
      <!-- ูุฑุจุน ุงููุต -->
      <textarea [(ngModel)]="complaintText"
        placeholder="ุงูุชุจ ุดููุชู"
        rows="10"
        class="w-full bg-[#F2F2F2] p-3 text-sm text-gray-700 border-0 rounded-md focus:outline-none focus:ring-0 placeholder:text-gray-400">
      </textarea>
  
      <!-- ุงุฎุชูุงุฑ ููู (ุงุฎุชูุงุฑู) -->
      <div class="mt-4">
        <label class="flex items-center justify-center gap-2 cursor-pointer bg-[#F2F2F2] hover:bg-gray-200 text-gray-700 font-medium py-3 px-4 rounded-md transition">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 17v-6l-2 2m2-2l2 2m8-2v6m0-6l-2 2m2-2l2 2M3 12h18M3 6h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>{{ selectedComplaintFile ? selectedComplaintFile.name : 'ุฅุฑูุงู ููู (ุงุฎุชูุงุฑู)' }}</span>
          <input type="file" (change)="onComplaintFileSelected($event)" class="hidden" accept="image/*,.pdf,.doc,.docx">
        </label>
      </div>
  
      <!-- ุฒุฑ ุงูุฅุฑุณุงู -->
      <div class="mt-6 flex justify-center">
        <button 
          (click)="submitComplaint()"
          [disabled]="isSubmittingComplaint"
          [class.opacity-50]="isSubmittingComplaint"
          [class.cursor-not-allowed]="isSubmittingComplaint"
          class="bg-[#6E5EA9] hover:bg-[#5a4e98] text-white font-semibold px-8 py-2 rounded-md flex items-center gap-2 text-sm transition">
          <svg *ngIf="!isSubmittingComplaint" width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M2.01 13L13 7.5 2.01 2 2 6l7 1.5L2 9z" fill="white" />
          </svg>
          <span *ngIf="isSubmittingComplaint" class="animate-spin inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full"></span>
          {{ isSubmittingComplaint ? 'ุฌุงุฑู ุงูุฅุฑุณุงู...' : 'ุฅุฑุณุงู' }}
        </button>
      </div>
  
    </div>
  </div>
  